<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Section 1 ¬∑ Project Overview</title>
  <meta name="description" content="Overview, milestones, and responsibilities for the histological kidney tissue project.">

  <style>
    :root {
      --bg:#ffffff;
      --text:#111111;
      --muted:#444444;
      --border:#dddddd;
      --accent:#004aad;
      --radius:14px;

      /* Sidebar tokens (match previous layout) */
      --sidebar-w: 300px;
      --sidebar-bg: #1f2328;
      --sidebar-bg-2: #14171b;
      --sidebar-text: rgba(255,255,255,0.92);
      --sidebar-muted: rgba(255,255,255,0.62);
      --sidebar-active: rgba(255,255,255,0.12);
      --sidebar-hover: rgba(255,255,255,0.08);
      --sidebar-divider: rgba(255,255,255,0.10);
    }

    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font:16px/1.7 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;
    }
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}

    /* ===== Layout: sidebar + content ===== */
    .layout{
      display:flex;
      min-height:100vh;
    }

    /* ===== Sidebar ===== */
    .sidebar{
      width:var(--sidebar-w);
      background:linear-gradient(180deg,var(--sidebar-bg),var(--sidebar-bg-2));
      color:var(--sidebar-text);
      position:sticky;
      top:0;
      height:100vh;
      overflow:auto;
      border-right:1px solid rgba(0,0,0,0.15);
    }
    .sidebar-header{
      padding:22px 20px 14px;
      border-bottom:1px solid var(--sidebar-divider);
    }
    .sidebar-title{
      font-size:22px;
      font-weight:750;
      margin:0;
      letter-spacing:.2px;
    }
    .sidebar-subtitle{
      margin:6px 0 0 0;
      color:var(--sidebar-muted);
      font-size:13px;
    }

    .side-nav{padding:10px 0;}
    .side-nav a{
      display:flex;
      align-items:center;
      gap:12px;

      padding:14px 18px;
      color:var(--sidebar-muted);
      text-decoration:none;

      border-top:1px solid rgba(255,255,255,0.03);
      border-bottom:1px solid rgba(0,0,0,0.12);
      transition:background .15s,color .15s;
    }
    .side-nav a:hover{
      background:var(--sidebar-hover);
      color:var(--sidebar-text);
      text-decoration:none;
    }
    .side-nav a.active{
      background:var(--sidebar-active);
      color:var(--sidebar-text);
    }
    .nav-ico{
      width:26px;height:26px;
      display:inline-grid;place-items:center;
      border-radius:8px;
      color:var(--sidebar-muted);
      flex:0 0 26px;
      font-size:16px;
    }
    .side-nav a.active .nav-ico{
      color:#ff6b8a;
    }
    .nav-text{
      font-size:15px;
      letter-spacing:.2px;
    }

    /* ===== Content ===== */
    .content{
      flex:1;
      background:var(--bg);
    }
    main{max-width:1100px;margin:0 auto;padding:30px 16px 60px;}
    h1{font-size:28px;margin-top:0;color:var(--accent);}
    h2{margin-top:28px;font-size:22px;color:var(--accent);}
    p{margin:10px 0;}

    section.content-block{
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:#fff;
      padding:24px 20px;
      margin-top:22px;
    }

    .image-block{
      text-align:center;
      margin-top:14px;
    }
    .image-block img{
      max-width:100%;
      height:auto;
      border-radius:var(--radius);
      box-shadow:0 4px 14px rgba(0,0,0,0.1);
    }

    /* keep your rotation helpers */
    .rotate-90{
      transform:rotate(270deg);
      transform-origin:center;
    }
    .rotate--90{
      transform:rotate(-90deg);
      transform-origin:center;
    }

    footer{
      border-top:1px solid var(--border);
      color:var(--muted);
      text-align:center;
      padding:18px 0;
      font-size:14px;
      margin-top:40px;
    }

    /* ===== Responsive: collapse sidebar to top ===== */
    @media (max-width: 900px){
      .layout{flex-direction:column;}
      .sidebar{
        width:100%;
        height:auto;
        position:relative;
      }
      .side-nav{
        display:grid;
        grid-template-columns:1fr 1fr;
      }
      .side-nav a{
        border:none;
        border-top:1px solid var(--sidebar-divider);
      }
    }

    /* ===== Document viewer styling (inherits your tokens) ===== */
    .docbar{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
      padding:12px;
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:#fff;
      margin-top:14px;
    }
    .doclabel{
      font-size:14px;
      color:var(--muted);
      margin-right:6px;
    }
    .docselect{
      min-width:260px;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:12px;
      background:#fff;
      color:var(--text);
      outline:none;
    }
    .doccontrols{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      margin-left:auto;
    }
    .docbtn{
      appearance:none;
      border:1px solid var(--border);
      background:#fff;
      color:var(--text);
      padding:9px 12px;
      border-radius:12px;
      cursor:pointer;
      font-size:14px;
      line-height:1;
    }
    .docbtn:hover{ background:#f7f7f7; }
    .doclink{ text-decoration:none; display:inline-flex; align-items:center; }
    .docmeta{
      font-size:14px;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:6px;
      padding:0 6px;
    }
    .docpage{
      width:70px;
      padding:8px 10px;
      border:1px solid var(--border);
      border-radius:10px;
      outline:none;
    }

    .docviewer{
      margin-top:14px;
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:#fafafa;
      padding:12px;
      overflow:auto;
      max-height:72vh;
    }
    .doccanvas-wrap{
      display:flex;
      justify-content:center;
    }

    /* Fullscreen polishing */
    #viewerWrap:fullscreen{
      background:#111;
      padding:18px;
    }
    #viewerWrap:fullscreen canvas{
      background:#fff;
      border-radius:12px;
    }
  </style>
</head>

<body>
  <div class="layout">
    <!-- LEFT SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1 class="sidebar-title">üìÅ My Project</h1>
        <p class="sidebar-subtitle">Histology workflow ¬∑ Nephrocalcinosis</p>
      </div>

      <nav class="side-nav">
        <a href="./index.html">
          <span class="nav-ico">‚Ü©Ô∏è</span>
          <span class="nav-text">Back to Index</span>
        </a>
        <a href="./part-1.html" class="active">
          <span class="nav-ico">üè†</span>
          <span class="nav-text">Photo</span>
        </a>
        <a href="./part-3.html">
          <span class="nav-ico">‚úçÔ∏è</span>
          <span class="nav-text">Activity</span>
        </a>
        <a href="./part-4.html">
          <span class="nav-ico">üìÑ</span>
          <span class="nav-text">Experiment Report</span>
        </a>
      </nav>
    </aside>

    <!-- RIGHT CONTENT -->
    <div class="content">
      <main>
        <h1>Section 1 ¬∑ Project Overview</h1>
        <p style="color:var(--muted)">Treatment and workflow with histological kidney tissue affected by nephrocalcinosis.</p>

        <!-- ===== Added: PDF/Document Viewer (keeps your original layout) ===== -->
        <section class="content-block">
          <h2>Documents</h2>
          <p style="color:var(--muted)">
            Select a document to preview. Use the controls to navigate pages.
          </p>

          <div class="docbar">
            <label class="doclabel" for="docSelect">Document</label>
            <select id="docSelect" class="docselect"></select>

            <div class="doccontrols">
              <button id="prevPage" class="docbtn" type="button">Prev</button>
              <button id="nextPage" class="docbtn" type="button">Next</button>

              <span class="docmeta">
                Page
                <input id="pageNumber" class="docpage" type="number" min="1" value="1">
                /
                <span id="pageCount">‚Äì</span>
              </span>

              <button id="zoomOut" class="docbtn" type="button">‚àí</button>
              <button id="zoomIn" class="docbtn" type="button">+</button>
              <button id="fitWidth" class="docbtn" type="button">Fit</button>

              <button id="fullscreen" class="docbtn" type="button">Full screen</button>
              <a id="downloadLink" class="docbtn doclink" href="#" download>Download</a>
            </div>
          </div>

          <div class="docviewer" id="viewerWrap">
            <div class="doccanvas-wrap">
              <canvas id="pdfCanvas"></canvas>
            </div>
          </div>

          <p style="margin-top:10px;color:var(--muted);font-size:14px">
            Note: Place your PDF files under <strong>./docs/</strong>. For Word documents, convert to PDF for the best
            paging experience.
          </p>
        </section>
      </main>

      <footer>
        ¬© <span id="year"></span> My Project ‚Äì All rights reserved.
      </footer>
    </div>
  </div>

  <!-- Keep your original footer year script -->
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <!-- PDF.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/build/pdf.min.js"></script>

  <!-- PDF viewer logic -->
<script>
  // ====== Configure your documents here ======
  const DOCS = [
    { title: "BUCHENYANG",    file: "./docs/BUCHENYANG.pdf" },
    { title: "MeishanLiu",    file: "./docs/MeishanLiu.pdf" },
    { title: "RuoqiZhao",     file: "./docs/RuoqiZhao.pdf" },
    { title: "Siluxin",       file: "./docs/Siluxin.pdf" },
    { title: "WuShengqi",     file: "./docs/WuShengqi.pdf" },
    { title: "YANZHA",        file: "./docs/YANZHA.PDF" },
    { title: "YingTengchuan", file: "./docs/YingTengchuan.pdf" },
    { title: "review",        file: "./docs/review.pdf" }
  ];

  // ====== Grab pdfjsLib robustly ======
  // Some builds expose window.pdfjsLib, others expose a different global.
  const pdfjsLib = window.pdfjsLib || window["pdfjs-dist/build/pdf"];
  if (!pdfjsLib) {
    alert("PDF.js failed to load. Check that the CDN script is reachable.");
    throw new Error("pdfjsLib not found on window.");
  }

  // Worker
  pdfjsLib.GlobalWorkerOptions.workerSrc =
    "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/build/pdf.worker.min.js";

  const docSelect = document.getElementById("docSelect");
  const pdfCanvas = document.getElementById("pdfCanvas");
  const ctx = pdfCanvas.getContext("2d");

  const prevPageBtn = document.getElementById("prevPage");
  const nextPageBtn = document.getElementById("nextPage");
  const zoomOutBtn  = document.getElementById("zoomOut");
  const zoomInBtn   = document.getElementById("zoomIn");
  const fitWidthBtn = document.getElementById("fitWidth");
  const fullscreenBtn = document.getElementById("fullscreen");

  const pageNumberInput = document.getElementById("pageNumber");
  const pageCountSpan = document.getElementById("pageCount");
  const downloadLink = document.getElementById("downloadLink");
  const viewerWrap = document.getElementById("viewerWrap");

  // ====== Simple error panel (injected) ======
  const errBox = document.createElement("div");
  errBox.style.display = "none";
  errBox.style.marginTop = "12px";
  errBox.style.padding = "12px";
  errBox.style.border = "1px solid #f1c1c1";
  errBox.style.borderRadius = "12px";
  errBox.style.background = "#fff5f5";
  errBox.style.color = "#8a1f1f";
  errBox.style.fontSize = "14px";
  viewerWrap.parentNode.insertBefore(errBox, viewerWrap);

  function showError(msg, err) {
    console.error(msg, err);
    errBox.style.display = "block";
    errBox.textContent = msg + (err?.message ? (" | " + err.message) : "");
  }
  function clearError() {
    errBox.style.display = "none";
    errBox.textContent = "";
  }

  let pdfDoc = null;
  let pageNum = 1;
  let scale = 1.15;
  let rendering = false;
  let pendingPage = null;

  function populateDropdown() {
    docSelect.innerHTML = "";
    DOCS.forEach((d, i) => {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = d.title;
      docSelect.appendChild(opt);
    });
  }

  async function loadDocument(index) {
    const doc = DOCS[index];
    if (!doc) return;

    clearError();
    downloadLink.href = doc.file;

    try {
      // IMPORTANT:
      // - Must be served over http(s), not file://
      // - If your server doesn't support range requests, these flags help
      pdfDoc = await pdfjsLib.getDocument({
        url: doc.file,
        disableAutoFetch: true,
        disableStream: true
      }).promise;

      pageNum = 1;
      pageCountSpan.textContent = String(pdfDoc.numPages);
      pageNumberInput.max = String(pdfDoc.numPages);
      pageNumberInput.value = "1";

      await renderPage(pageNum);
      fitToWidth();
    } catch (err) {
      pdfDoc = null;
      pageCountSpan.textContent = "‚Äì";
      showError(
        "Failed to load PDF. Most common reasons: (1) opened via file:// instead of a web server, (2) wrong path/docs folder, (3) filename case mismatch (YANZHA.PDF vs YANZHA.pdf).",
        err
      );
    }
  }

  async function renderPage(num) {
    if (!pdfDoc) return;
    rendering = true;

    const page = await pdfDoc.getPage(num);
    const viewport = page.getViewport({ scale });

    const outputScale = window.devicePixelRatio || 1;
    pdfCanvas.width = Math.floor(viewport.width * outputScale);
    pdfCanvas.height = Math.floor(viewport.height * outputScale);
    pdfCanvas.style.width = Math.floor(viewport.width) + "px";
    pdfCanvas.style.height = Math.floor(viewport.height) + "px";

    const transform = outputScale !== 1 ? [outputScale, 0, 0, outputScale, 0, 0] : null;

    const renderContext = { canvasContext: ctx, viewport, transform };
    await page.render(renderContext).promise;

    rendering = false;
    if (pendingPage !== null) {
      const p = pendingPage;
      pendingPage = null;
      await renderPage(p);
    }
  }

  function queueRenderPage(num) {
    if (rendering) pendingPage = num;
    else renderPage(num);
  }

  function clampPage(n) {
    if (!pdfDoc) return 1;
    return Math.min(Math.max(1, n), pdfDoc.numPages);
  }

  function goToPage(n) {
    if (!pdfDoc) return;
    pageNum = clampPage(n);
    pageNumberInput.value = String(pageNum);
    queueRenderPage(pageNum);
  }

  function fitToWidth() {
    if (!pdfDoc) return;
    pdfDoc.getPage(pageNum).then(page => {
      const wrapWidth = viewerWrap.clientWidth - 24;
      const unscaled = page.getViewport({ scale: 1 });
      scale = Math.max(0.5, Math.min(3.0, wrapWidth / unscaled.width));
      queueRenderPage(pageNum);
    });
  }

  // Events
  docSelect.addEventListener("change", () => loadDocument(Number(docSelect.value)));
  prevPageBtn.addEventListener("click", () => goToPage(pageNum - 1));
  nextPageBtn.addEventListener("click", () => goToPage(pageNum + 1));
  pageNumberInput.addEventListener("change", () => goToPage(Number(pageNumberInput.value)));

  zoomOutBtn.addEventListener("click", () => { scale = Math.max(0.5, scale - 0.1); queueRenderPage(pageNum); });
  zoomInBtn.addEventListener("click", () => { scale = Math.min(3.0, scale + 0.1); queueRenderPage(pageNum); });
  fitWidthBtn.addEventListener("click", fitToWidth);

  fullscreenBtn.addEventListener("click", async () => {
    if (!document.fullscreenElement) {
      await viewerWrap.requestFullscreen();
      setTimeout(fitToWidth, 150);
    } else {
      await document.exitFullscreen();
    }
  });

  window.addEventListener("resize", () => { if (pdfDoc) fitToWidth(); });

  // Init
  populateDropdown();
  loadDocument(0);
</script>

</body>
</html>
